generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Project {
  id                String            @id @default(uuid())
  name              String
  appType           AppType           @default(FULLSTACK_WEB)
  projectType       ProjectType       // @deprecated - kept for migration compatibility
  frontendFramework FrontendFramework @default(REACT_VITE)
  backendFramework  BackendFramework  @default(EXPRESS)
  techStackConfig   String?           @default("{}")
  path              String
  description      String?
  claudeSessionId  String?           // Claude Code CLI session ID for conversation continuity

  // Database infrastructure
  databaseProvider  DatabaseProvider? // null means not yet created
  databaseUrl       String?           // Connection URL (stored encrypted in production)
  dockerContainerId String?           // Docker container ID for postgres_docker provider

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages Message[]
  reviews  Review[]

  @@map("projects")
}

model Message {
  id        String   @id @default(uuid())
  projectId String
  role      Role
  content   String
  metadata  String?
  createdAt DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("messages")
}

enum AppType {
  FULLSTACK_WEB   // Frontend + Backend
  FRONTEND_ONLY   // Static site / SPA
  API_ONLY        // Backend only
  MOBILE          // Mobile app only
  MOBILE_WITH_API // Mobile app + Backend
}

// @deprecated Use AppType instead
enum ProjectType {
  WEB
  NATIVE
}

enum FrontendFramework {
  // Web
  REACT_VITE    // React + Vite (default)
  NEXTJS        // Next.js
  VUE           // Vue 3 + Vite
  SVELTE        // SvelteKit
  // Mobile
  REACT_NATIVE  // React Native
  FLUTTER       // Flutter (Dart)
  EXPO          // Expo (React Native based)
  // None
  NONE          // Backend only
}

enum BackendFramework {
  NONE
  EXPRESS
  FASTAPI
  DJANGO
  NESTJS
}

enum DatabaseProvider {
  POSTGRES_DOCKER
  SQLITE
}

enum Role {
  USER
  ASSISTANT
  SYSTEM
}

enum ReviewStatus {
  RUNNING
  COMPLETED
  FAILED
  AUTO_FIXING
}

model Review {
  id               String       @id @default(uuid())
  projectId        String
  status           ReviewStatus @default(RUNNING)
  summary          String?
  overallScore     Int?
  issues           String?      @default("[]")  // JSON array of ReviewIssue
  strengths        String?      @default("[]")  // JSON array of strings
  recommendations  String?      @default("[]")  // JSON array of strings
  cost             Float?
  triggerMessageId String?
  createdAt        DateTime     @default(now())
  completedAt      DateTime?

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model Setting {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt

  @@map("settings")
}
